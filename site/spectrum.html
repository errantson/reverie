<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectrum - Reverie House</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Navigate the Reverie Spectrum and find your place within the balance of dreaming' forces. Learn where you began within it.">
    <meta name="keywords" content="spectrum, consciousness, octants, oblivion, entropy, authority, liberty, skeptic, receptive, awareness">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://reverie.house/spectrum.html">
    <meta property="og:title" content="Spectrum - Reverie House">
    <meta property="og:description" content="Navigate the Reverie Spectrum and find your place within the balance of dreaming' forces. Learn where you began within it.">
    <meta property="og:image" content="https://reverie.house/assets/og-image.png">
    <meta property="og:site_name" content="Reverie House">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Spectrum - Reverie House">
    <meta name="twitter:description" content="Navigate the Reverie Spectrum and find your place within the balance of dreaming' forces. Learn where you began within it.">
    <meta name="twitter:image" content="https://reverie.house/assets/og-image.png">
    
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/heraldry.css">
    <link rel="stylesheet" href="/css/pages/spectrum.css">
    <link rel="stylesheet" href="/css/octants.css">
    <link rel="stylesheet" href="/css/widgets/login.css">
    <link rel="stylesheet" href="/css/widgets/createdreamer.css">
    <link rel="stylesheet" href="/css/widgets/dialogue.css">
    <link rel="stylesheet" href="/css/widgets/dreamer-hover.css">
    <link rel="stylesheet" href="/css/widgets/popup.css">
    
    <!-- Favicon and Icons -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">
    <link rel="manifest" href="/assets/site.webmanifest">
    
    <!-- Core utilities (must load first) -->
    <script src="/js/core/world-config-cache.js"></script>
    <script src="/js/core/color-manager.js"></script>
    <script src="/js/utils/shadowbox.js"></script>
    <script src="/js/utils/heraldry.js"></script>
    <script src="/js/utils/orientation-handler.js"></script>
    
    <!-- Background widget -->
    <script src="/js/widgets/background.js"></script>
    
    <!-- Scripts -->
    <script src="/js/widgets/header.js" defer></script>
    <script type="module" src="/js/widgets/oauth-manager.js"></script>
    <script src="/js/widgets/login.js" defer></script>
    <script src="/js/widgets/createdreamer.js" defer></script>
    <script src="/js/widgets/drawer.js" defer></script>
    <script src="/js/widgets/axisexplainer.js" defer></script>
    <script src="/js/widgets/dreamer-hover.js" defer></script>
    <script src="/js/widgets/popup.js" defer></script>
    <script src="/js/widgets/spectrum.js" defer></script>
    <script src="/js/widgets/spectrum-deluxe.js" defer></script>
    <script type="module" src="/js/widgets/spectrumpreview.js"></script>
    <script src="/js/widgets/spectrumcalculator-modal.js?v=2" defer></script>
    <script src="/js/widgets/konami.js" defer></script>
</head>
<body>
    <!-- Dynamic background -->
    <div class="fullscreen-background">
        <div class="scene-background">
            <img src="/souvenirs/residence/phanera.png" alt="Phanera Residence" class="scene-layer background-layer">
        </div>
    </div>
    
    <div id="header-container"></div>
    
    <div class="main-content">
        <!-- Visualization Section -->
        <div class="spectrum-visualization">
            <div class="spectrum-container deluxe-mode">
                <div class="canvas-container">
                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">Loading the spectrum...</div>
                        </div>
                    </div>
                    <canvas id="spectrumCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-container"></div>

    <script>
        // Debug logging for spectrum page
        console.log('ðŸ“Š [Spectrum] Script starting...');
        console.log('ðŸ“Š [Spectrum] Document readyState:', document.readyState);
        
        // Initialize the deluxe spectrum visualizer when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸ“Š [Spectrum] ===== DOM CONTENT LOADED =====');
            console.log('ðŸ“Š [Spectrum] Document readyState:', document.readyState);
            console.log('ðŸ“Š [Spectrum] Body element:', document.body);
            console.log('ðŸ“Š [Spectrum] Body classes:', document.body.className);
            
            // Check for ALL elements in the DOM
            const allElements = document.querySelectorAll('*');
            console.log('ðŸ“Š [Spectrum] Total elements in DOM:', allElements.length);
            
            // Look for any octant-related elements
            const octantElements = document.querySelectorAll('[class*="octant"], [id*="octant"]');
            console.log('ðŸ“Š [Spectrum] âš ï¸ OCTANT-RELATED ELEMENTS FOUND:', octantElements.length);
            if (octantElements.length > 0) {
                octantElements.forEach((el, i) => {
                    const rect = el.getBoundingClientRect();
                    const styles = window.getComputedStyle(el);
                    console.log(`ðŸ“Š [Spectrum] ðŸ”´ OCTANT ELEMENT ${i}:`, {
                        tag: el.tagName,
                        id: el.id,
                        classes: el.className,
                        display: styles.display,
                        position: styles.position,
                        visibility: styles.visibility,
                        rect: { top: rect.top, left: rect.left, width: rect.width, height: rect.height },
                        element: el
                    });
                });
            }
            
            // Look for any modality elements
            const modalityElements = document.querySelectorAll('[class*="modality"]');
            console.log('ðŸ“Š [Spectrum] âš ï¸ MODALITY ELEMENTS FOUND:', modalityElements.length);
            if (modalityElements.length > 0) {
                modalityElements.forEach((el, i) => {
                    const rect = el.getBoundingClientRect();
                    const styles = window.getComputedStyle(el);
                    console.log(`ðŸ“Š [Spectrum] ðŸ”´ MODALITY ELEMENT ${i}:`, {
                        tag: el.tagName,
                        id: el.id,
                        classes: el.className,
                        display: styles.display,
                        position: styles.position,
                        rect: { top: rect.top, left: rect.left, width: rect.width, height: rect.height },
                        element: el
                    });
                });
            }
            
            const canvas = document.getElementById('spectrumCanvas');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const mainContent = document.querySelector('.main-content');
            const spectrumVisualization = document.querySelector('.spectrum-visualization');
            const spectrumContainer = document.querySelector('.spectrum-container');
            const canvasContainer = document.querySelector('.canvas-container');
            const header = document.getElementById('header-container');
            const footer = document.getElementById('footer-container');
            const background = document.querySelector('.fullscreen-background');
            
            console.log('ðŸ“Š [Spectrum] Canvas element:', canvas);
            console.log('ðŸ“Š [Spectrum] Loading overlay:', loadingOverlay);
            console.log('ðŸ“Š [Spectrum] Main content:', mainContent);
            console.log('ðŸ“Š [Spectrum] Spectrum visualization:', spectrumVisualization);
            console.log('ðŸ“Š [Spectrum] Spectrum container:', spectrumContainer);
            console.log('ðŸ“Š [Spectrum] Canvas container:', canvasContainer);
            console.log('ðŸ“Š [Spectrum] Header:', header);
            console.log('ðŸ“Š [Spectrum] Footer:', footer);
            console.log('ðŸ“Š [Spectrum] Background:', background);
            
            // Calculate viewport and positions
            const viewport = {
                width: window.innerWidth,
                height: window.innerHeight
            };
            console.log('ðŸ“Š [Spectrum] ðŸ“ Viewport:', viewport);
            
            if (header) {
                const headerRect = header.getBoundingClientRect();
                const headerStyles = window.getComputedStyle(header);
                console.log('ðŸ“Š [Spectrum] ðŸ“ Header:', {
                    rect: { top: headerRect.top, left: headerRect.left, width: headerRect.width, height: headerRect.height },
                    bottom: headerRect.bottom,
                    position: headerStyles.position,
                    zIndex: headerStyles.zIndex
                });
            }
            
            if (footer) {
                const footerRect = footer.getBoundingClientRect();
                const footerStyles = window.getComputedStyle(footer);
                console.log('ðŸ“Š [Spectrum] ðŸ“ Footer/Drawer:', {
                    rect: { top: footerRect.top, left: footerRect.left, width: footerRect.width, height: footerRect.height },
                    position: footerStyles.position,
                    zIndex: footerStyles.zIndex
                });
            }
            
            if (background) {
                const bgRect = background.getBoundingClientRect();
                const bgStyles = window.getComputedStyle(background);
                console.log('ðŸ“Š [Spectrum] ðŸ“ Background:', {
                    rect: { top: bgRect.top, left: bgRect.left, width: bgRect.width, height: bgRect.height },
                    position: bgStyles.position,
                    zIndex: bgStyles.zIndex
                });
            }
            
            if (mainContent) {
                const styles = window.getComputedStyle(mainContent);
                const rect = mainContent.getBoundingClientRect();
                const availableHeight = viewport.height - (header?.getBoundingClientRect().height || 0) - (footer?.getBoundingClientRect().height || 0);
                console.log('ðŸ“Š [Spectrum] ðŸ“ Main content:', {
                    display: styles.display,
                    alignItems: styles.alignItems,
                    justifyContent: styles.justifyContent,
                    minHeight: styles.minHeight,
                    padding: styles.padding,
                    position: styles.position,
                    zIndex: styles.zIndex,
                    rect: { top: rect.top, left: rect.left, width: rect.width, height: rect.height },
                    availableHeight: availableHeight,
                    centerY: rect.top + (rect.height / 2)
                });
            }
            
            if (spectrumVisualization) {
                const styles = window.getComputedStyle(spectrumVisualization);
                const rect = spectrumVisualization.getBoundingClientRect();
                console.log('ðŸ“Š [Spectrum] ðŸ“ Spectrum visualization:', {
                    display: styles.display,
                    maxWidth: styles.maxWidth,
                    width: styles.width,
                    margin: styles.margin,
                    padding: styles.padding,
                    rect: { top: rect.top, left: rect.left, width: rect.width, height: rect.height },
                    centerX: rect.left + (rect.width / 2),
                    centerY: rect.top + (rect.height / 2)
                });
            }
            
            if (spectrumContainer) {
                const styles = window.getComputedStyle(spectrumContainer);
                const rect = spectrumContainer.getBoundingClientRect();
                const headerHeight = header?.getBoundingClientRect().height || 0;
                const footerHeight = footer?.getBoundingClientRect().height || 0;
                const viewportMidY = viewport.height / 2;
                const availableSpaceMidY = headerHeight + ((viewport.height - headerHeight - footerHeight) / 2);
                const containerMidY = rect.top + (rect.height / 2);
                
                console.log('ðŸ“Š [Spectrum] ðŸ“ Spectrum container:', {
                    display: styles.display,
                    minHeight: styles.minHeight,
                    maxHeight: styles.maxHeight,
                    width: styles.width,
                    position: styles.position,
                    overflow: styles.overflow,
                    rect: { top: rect.top, left: rect.left, width: rect.width, height: rect.height },
                    centerX: rect.left + (rect.width / 2),
                    centerY: containerMidY,
                    viewportCenterX: viewport.width / 2,
                    viewportCenterY: viewportMidY,
                    availableSpaceCenterY: availableSpaceMidY,
                    offsetFromViewportCenter: containerMidY - viewportMidY,
                    offsetFromAvailableCenter: containerMidY - availableSpaceMidY
                });
            }
            
            if (canvasContainer) {
                const rect = canvasContainer.getBoundingClientRect();
                const styles = window.getComputedStyle(canvasContainer);
                console.log('ðŸ“Š [Spectrum] ðŸ“ Canvas container:', {
                    rect: { top: rect.top, left: rect.left, width: rect.width, height: rect.height },
                    display: styles.display,
                    position: styles.position,
                    flexGrow: styles.flexGrow,
                    background: styles.background
                });
            }
            
            if (canvas) {
                console.log('ðŸ“Š [Spectrum] Canvas dimensions:', {
                    width: canvas.width,
                    height: canvas.height,
                    clientWidth: canvas.clientWidth,
                    clientHeight: canvas.clientHeight
                });
                
                const canvasStyles = window.getComputedStyle(canvas);
                console.log('ðŸ“Š [Spectrum] Canvas styles:', {
                    width: canvasStyles.width,
                    height: canvasStyles.height,
                    minHeight: canvasStyles.minHeight,
                    cursor: canvasStyles.cursor,
                    background: canvasStyles.background
                });
                
                // Wait for SpectrumDeluxe to be available
                const initDeluxe = () => {
                    if (typeof SpectrumDeluxe !== 'undefined') {
                        console.log('ðŸ“Š [Spectrum] SpectrumDeluxe class found, creating instance...');
                        // Create the deluxe visualizer
                        const visualizer = new SpectrumDeluxe(canvas, {
                            showLabels: true,
                            showAllNames: false,
                            initialZoom: 1.2,
                            liveUpdate: true,
                            liveUpdateInterval: 120000, // 2 minutes
                        });
                        console.log('ðŸ“Š [Spectrum] SpectrumDeluxe instance created:', visualizer);

                        // Hide loading overlay after a brief delay
                        setTimeout(() => {
                            console.log('ðŸ“Š [Spectrum] Hiding loading overlay');
                            loadingOverlay.classList.add('hidden');
                        }, 1500);

                        // Store visualizer globally for debugging
                        window.spectrumVisualizer = visualizer;
                        console.log('ðŸ“Š [Spectrum] Visualizer stored in window.spectrumVisualizer');
                    } else {
                        console.log('ðŸ“Š [Spectrum] SpectrumDeluxe not yet available, waiting...');
                        // Wait a bit and try again
                        setTimeout(initDeluxe, 100);
                    }
                };
                
                initDeluxe();
            } else {
                console.error('ðŸ“Š [Spectrum] Canvas element not found!');
            }
            
            console.log('ðŸ“Š [Spectrum] ===== SETUP COMPLETE =====');
        });

        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (window.spectrumVisualizer) {
                    window.spectrumVisualizer.resize();
                }
            }, 100);
        });

        // Handle orientation changes for mobile devices
        if (window.orientationHandler) {
            window.orientationHandler.subscribe((data) => {
                if (window.spectrumVisualizer) {
                    window.spectrumVisualizer.resize();
                }
            });
        }
    </script>
</body>
</html>
