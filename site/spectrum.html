<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectrum - Reverie House</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Navigate the Reverie Spectrum and find your place within the balance of dreaming' forces. Learn where you began within it.">
    <meta name="keywords" content="spectrum, consciousness, octants, oblivion, entropy, authority, liberty, skeptic, receptive, awareness">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://reverie.house/spectrum.html">
    <meta property="og:title" content="Spectrum - Reverie House">
    <meta property="og:description" content="Navigate the Reverie Spectrum and find your place within the balance of dreaming' forces. Learn where you began within it.">
    <meta property="og:image" content="https://reverie.house/assets/og-image.png">
    <meta property="og:site_name" content="Reverie House">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Spectrum - Reverie House">
    <meta name="twitter:description" content="Navigate the Reverie Spectrum and find your place within the balance of dreaming' forces. Learn where you began within it.">
    <meta name="twitter:image" content="https://reverie.house/assets/og-image.png">
    
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/heraldry.css">
    <link rel="stylesheet" href="/css/pages/spectrum.css">
    <link rel="stylesheet" href="/css/octants.css">
    <link rel="stylesheet" href="/css/widgets/login.css">
    <link rel="stylesheet" href="/css/widgets/createdreamer.css">
    <link rel="stylesheet" href="/css/widgets/dialogue.css">
    <link rel="stylesheet" href="/css/widgets/dreamer-hover.css">
    <link rel="stylesheet" href="/css/widgets/popup.css">
    
    <!-- Favicon and Icons -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">
    <link rel="manifest" href="/assets/site.webmanifest">
    
    <!-- Core utilities (must load first) -->
    <script src="/js/core/world-config-cache.js"></script>
    <script src="/js/core/color-manager.js"></script>
    <script src="/js/utils/shadowbox.js"></script>
    <script src="/js/utils/heraldry.js"></script>
    <script src="/js/utils/orientation-handler.js"></script>
    
    <!-- Background widget -->
    <script src="/js/widgets/background.js"></script>
    
    <!-- Scripts -->
    <script src="/js/core/avatar-cache.js" defer></script>
    <script src="/js/widgets/header.js" defer></script>
    <script type="module" src="/js/widgets/oauth-manager.js"></script>
    <script src="/js/widgets/login.js" defer></script>
    <script src="/js/widgets/createdreamer.js" defer></script>
    <script src="/js/widgets/drawer.js" defer></script>
    <script src="/js/widgets/axisexplainer.js" defer></script>
    <script src="/js/widgets/dreamer-hover.js" defer></script>
    <script src="/js/widgets/popup.js" defer></script>
    <script src="/js/widgets/spectrum.js?v=3" defer></script>
    <script src="/js/widgets/spectrum-deluxe.js" defer></script>
    <script type="module" src="/js/widgets/spectrumpreview.js"></script>
    <script src="/js/widgets/spectrumcalculator-modal.js?v=2" defer></script>
    <script src="/js/widgets/konami.js" defer></script>
</head>
<body>
    <!-- Dynamic background -->
    <div class="fullscreen-background">
        <div class="scene-background">
            <img src="/souvenirs/residence/phanera.png" alt="Phanera Residence" class="scene-layer background-layer">
        </div>
    </div>
    
    <div id="header-container"></div>
    
    <div class="main-content">
        <!-- Visualization Section -->
        <div class="spectrum-visualization">
            <div class="spectrum-container deluxe-mode">
                <div class="canvas-container">
                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">Loading the spectrum...</div>
                        </div>
                    </div>
                    <canvas id="spectrumCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('spectrumCanvas');
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (!canvas) return;

            const initDeluxe = async () => {
                // Wait for header CSS to load (prevents layout race conditions)
                let attempts = 0;
                while (attempts++ < 20) {
                    const headerCSS = document.querySelector('link[href*="css/widgets/header.css"]');
                    if (headerCSS?.sheet) break;
                    await new Promise(r => setTimeout(r, 50));
                }
                await new Promise(r => setTimeout(r, 50));

                if (typeof SpectrumDeluxe !== 'undefined') {
                    const visualizer = new SpectrumDeluxe(canvas, {
                        showLabels: true,
                        showAllNames: false,
                        initialZoom: 1.2,
                        liveUpdate: true,
                        liveUpdateInterval: 120000,
                    });
                    
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => visualizer.resize());
                    });

                    setTimeout(() => loadingOverlay.classList.add('hidden'), 1500);
                    window.spectrumVisualizer = visualizer;
                } else {
                    setTimeout(initDeluxe, 100);
                }
            };
            
            initDeluxe();
        });

        // Resize handling
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => window.spectrumVisualizer?.resize(), 100);
        });

        window.orientationHandler?.subscribe(() => window.spectrumVisualizer?.resize());
    </script>
</body>
</html>
